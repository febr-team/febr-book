# Observações no espaço e no tempo

Diversas aplicações requerem o conhecimento da localização das observações do solo no plano geográfico, na
linhas temporal, ou em ambos. Por exemplo, análises geoestatísticas e de séries temporais. Assim, mesmo que um
determinado conjunto de dados não seja produzido com esse propósito, seu reuso futuro depende, em parte, do 
conhecimento das coordenadas espaciais, *x* e *y*, e temporal, *t*. No **febr**, essas informações são 
inseridas na tabela denominada *observacao*.

Além das coordenadas espaciais e temporais, à toda observação do solo estão vinculadas condições ambientais 
específicas. Tais condições ambientais podem ser de maior ou menor interesse, controladas ou naturais, 
determinantes ou auxiliares na explicação das características do solo. Estão incluídas aí informações sobre o 
relevo local, o material de origem e a rocha subjacente, o tipo de uso da terra pretérito e presente, e assim 
por diante. Quando registradas, tais informações são também inseridas na tabela *observacao*.

As observações espaço-temporais do solo também costumam ser acompanhadas por informações locais sobre o 
próprio solo e que refletem sua relação com o ambiente. Tais informações expressam as características físicas,
químicas e (micro)biológicas do solo. Por exemplo, a condição de drenagem, a presença de pedregosidade e
rochosidade, a classificação taxonômica, a presença de contato lítico, e a própria profundidade do solo. Na
verdade, muitos conjuntos de dados do solo possuem apenas esse tipo de informação, geralmente quando gerados
em projeto de cunho mais exploratório, quando não são coletadas amostras das camadas do solo (#camadas). Assim 
como as informações sobre as condições ambientais, essas informações locais sobre o solo também são inseridas 
na tabela *observacao*.

Diferente da tabela *dataset*, que armazena os dados em linhas, a tabela *observacao* está organizada de 
maneira a armazenar os dados em colunas. Assim, à cada observação do solo é dedicada uma linha exclusiva, e os
dados adicionados sequencialmente nas colunas. Como o número de observações do solo varia de conjunto de dados
para conjunto de dados, não há limite de linhas na tabela *observacao*. Da mesma forma, como os dados coletados
durante uma observação do solo podem ser muitos e diversos, não há imposição de limites quanto ao número máximo
de colunas. Apenas três requerimentos precisam ser atendidos. Primeiro, devem ser preenchidas todas as colunas
obrigatórias (destaque em vermelho) e, sempre que possível, todas as colunas recomendadas (destaque em 
amarelo). Segundo, deve ser usado estilo de nomeclatura padronizado para as demais colunas opcionais (destaque
em verde). Por fim, enquanto a primeira linha da tabela *observacao* contém o nome das colunas, a segunda deve
ficar reservada para registrar as unidades de medida, por exemplo, para variáveis como a profundidade do solo.
As próximas seções descrevem a estrutura da tabela *observacao*.

## Identificação

Cada observação é identificada usando um código identificador exclusivo definido conforme a identificação usada no conjunto de dados de origem. Esse código identificador, informado na coluna `observacao_id`, é a única informação de preenchimento obrigatório na tabela *observacao*. Por se tratar de um código identificador exclusivo, um mesmo conjunto de dados não terá nunca um `observacao_id` repetido. Contudo, diferentes conjuntos de dados podem, e geralmente possuem, `observacao_id` iguais entre si.

Como se trata de um código de identificação, não são usados espaços ou caracteres especiais no `observacao_id`. Espaços são substituídos por um *underscore*, `_`, ou traço, `-`. Caracteres especiais são substituídos pelo caractere correspondente simplificado, ou seja, `á` torna-se `a`, `ç` torna-se `c`, e assim por diante. Por  exemplo, uma observação identificada no trabalho de origem como Perfil 01 será identificada no **febr** como `Perfil-01`.

No caso dos conjuntos de dados obtidos de outros repositórios ou bases de dados, como o SISB, reserva-se também uma coluna para armazenar o código identificador usado no repositório ou base de dados de origem (Tabela \@ref(tab:observacao-id)). Essa estratégia possibilita que, no futuro, e em havendo interesse por parte dos mantenedores desses repositórios e bases de dados, seja estabelecida comunicação direta com o **febr**. Assim, seria possível atualizar seus dados à medida que ajustes e correções nos dados forem sendo feitos no **febr**.

```{r, echo=FALSE}
versao <- 
  rbind(
    c("`observacao_id`", "identificador exclusivo no **febr**"),
    c("`sisb_id`", "identificador exclusivo no Sistema de Informação de Solos Brasileiros"),
    c("`ibge_id`", "identificador exclusivo na base de dados do IBGE"),
    c("`esalq_id`", "identificador exclusivo na base de dados da Esalq")
  )
colnames(versao) <- c("**campo**", "**valor**")
pander(versao, caption = "(\\#tab:observacao-id) Identificação das observações do solo.")
```

## Coordenada temporal

Data da observação (`observacao_data`) no formato dd-mm-aaaa. A data de observação é um dos atributos que,
juntamente com as
coordenadas espaciais, definem uma observação em um conjunto de dados. Isso significa que a observação 
repetida, ao longo do tempo, de um mesmo local no espaço, caracteriza a constituição de uma nova observação,
portanto, a definição de uma nova `observacao_id`. O valor padrão, para os casos em que a data de observação é
desconhecida, é `observacao_data = xx-xx-xxxx`. Quando somente o dia e/ou o mês de observação são 
desconhecidos, usa-se o primeiro valor da sequência, ou seja, `dd = 01` e `mm = 01`.

## Coordenadas espaciais {#coordenadas}

A localização espacial de uma observação do solo é especificada usando coordenadas espaciais, também 
conhecidas como coordenadas geográficas. Para isso são usados os cinco itens descritos na Tabela 
\@ref(tab:coordenadas). 

```{r coordenadas, echo=FALSE}
cap <- "(\\#tab:coordenadas) Itens usados para especificar a localização espacial das observações do solo."
rbind(
  c("`coord_sistema`", "sistema de referência de coordenadas"),
  c("`coord_x`", "coordenada x ou longitude"),
  c("`coord_y`", "coordenada y ou latitude"),
  c("`coord_precisao`", "precisão das coordenadas espaciais"),
  c("`coord_fonte`", "fonte das coordenadas espaciais")
  ) %>% 
  colNames() %>% 
  pander(caption = cap)
```

O primeiro item, `coord_sistema`, refere-se ao sistema de referência de coordenadas (SRC) utilizado para o
georreferenciamento das observações do solo. A especificação do SRC é fundamental para possibilitar o uso
apropriado de dados espaciais em sistemas de informação geográfica (SIG), especialmente para fins de correlação
e/ou cruzamento com outros dados espaciais. Tradicionalmente, a especificação do SRC é feita de diversas 
maneiras, mas a forma mais usual é aquela no formato de texto legível por humanos. Por exemplo, WGS84 / UTM
zona 23S, que identifica o datum geodético WGS84 e a zona 23 do hemisfério sul na projeção cartográfica UTM.
Esse tipo de identificação não é usado do **febr** pois, não sendo padronizado, dificulta a automatização da
manipulação computacional dos conjuntos de dados. Assim, o **febr** adota os códigos padronizados e aceitos
internacionalmente do EPSG, os quais são legíveis por humanos e por máquinas. Os códigos dos sistemas de 
referência de coordenadas geográficas e projetadas mais usados no Brasil são mostrados nas Tabelas
\@ref(tab:geografica) e \@ref(tab:projetada).

```{r geografica, echo=FALSE}
cap <- "(\\#tab:geografica) Códigos EPSG dos sistemas de referência de coordenadas geográficas para o Brasil."
rbind(
  c("`EPSG:4326`", "WGS84"),
  c("`EPSG:4225`", "Córrego Alegre"),
  c("`EPSG:4618`", "SAD69"),
  c("`EPSG:4674`", "SIRGAS2000")
  ) %>% 
  colNames(names = c('**Código**', '**Definição**')) %>% 
  pander(caption = cap)
```

```{r projetada, echo=FALSE}
cap <- "(\\#tab:projetada) Códigos EPSG dos sistemas de referência de coordenadas projetadas para o Brasil."
rbind(
  c("18N", "-", 29168, 32618, 31972),
  c("18S", "-", 29188, 32718, 31978),
  c("19N", "-", 29169, 32619, 31973),
  c("19S", "-", 29189, 32719, 31979),
  c("20N", "-", 29170, 32620, 31974),
  c("20S", "-", 29190, 32720, 31980),
  c("21S", 22521, 29191, 32721, 31981),
  c("22S", 22522, 29192, 32722, 31982),
  c("23S", 22523, 29193, 32723, 31983),
  c("24S", 22524, 29194, 32724, 31984),
  c("25S", 22525, 29195, 32725, 31985)
  ) %>% 
  colNames(
    names = c('**Zona e hemisfério**', '**Córrego Alegre**', '**SAD69**', '**WGS84**', '**SIRGAS2000**')) %>% 
  pander(caption = cap)
```

Os valores das duas coordenadas espaciais, x e y, são especificadas usando os itens `coord_x` e `coord_y`,
respectivamente. Aqui, x é o mesmo que longitude e y é o mesmo que latitude. A diferença fundamental entre as
duas nomenclaturas é que, enquanto longitude/latitude refere-se a coordenadas geográficas, x/y refere-se a
coordenadas projetadas. No caso das coordenadas geográficas, usa-se o formato decimal, sendo a unidade de 
medida o grau (°). Já para as coordenadas projetadas, a unidade de medida é o metro (m). Em ambos os casos, 
utiliza-se a vírgula como separador decimal, sendo esse o padrão da língua portuguesa.

Os dois 

Precisão (`coord_precisao`) com que as coordenadas espaciais foram determinadas (em metros).

`coord_fonte`

```{r, echo=FALSE}
cap <- "(\\#tab:coord-fonte) Fontes de coordenadas espaciais."
rbind(
  c("`GPS`", "aparelho GPS"),
  c("`MAPA`", "mapa analógico ou digital"),
  c("`WEB`", "serviço web como o Google Maps")
  ) %>% 
  colNames(names = c('**Código**', '**Definição**')) %>% 
  pander(caption = cap)
```


## Localização

Identificação do município (`municipio_id`), estado (`estado_id`) -- ou unidade federativa -- e país 
(`pais_id`) onde a observação foi realizada. Como o **febr**  trata apenas de conjuntos de dados produzidos no
Brasil, usa-se o código ISO 3166-1 alpha-2 do Brasil, ou seja, `BR`. No caso do estado -- ou unidade 
federativa --, usa-se a abreviação da respectiva unidade federativa (UF). O nome do município é escrito por
extenso, conforme encontrado na fonte.

## Amostragem

Tipo de amostragem (`amostra_tipo`). Opções: SIMPLES ou COMPOSTA.

Número de amostras (`amostra_quanti`). Um (1) quando o valor da variável anterior é SIMPLES ou mais para COMPOSTA. Expressar o valor com números inteiros.

Área amostral (m^2^) (`amostra_area`). Por exemplo, a área de uma trincheira costuma ser de 1 m^2^.

<!-- ## `taxon_<sistema>_<ano>`

Identificação do sistema de classificação -- taxonomia -- utilizado para classificar a observação do solo,
incluindo nome e ano, bem a classificação -- táxon -- atribuída à observação, incluíndo nome e sigla. Tanto o
nome como o ano de publicação do sistema de classificação utilizado auxilia na verificação de possíveis
inconsistências na classificação da observação e no processo de harmonização dos dados. O nome da 
classificação atribuída à observação do solo deve ser escrito por extenso, mantendo quaisquer espaços e
caracteres especiais presentes, prefere

Código     | Sistema taxonômico
---------- | -------------------------------------------
fao-unesco | Legend of the World Soil Map
fao-wrb    | World Reference Base for Soil Resources
sibcs      | Sistema Brasileiro de Classificação do Solo
st         | Soil Taxonomy
usc        | Universal Soil Classification

Para os conjuntos de dados que incluem observações do solo classificadas usando dois ou mais sistemas de
classificação, ou diferentes versões do mesmo sistema de classificação, insere-se tantas colunas quantas
forem necessárias.
 -->
